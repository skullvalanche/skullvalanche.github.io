<!DOCTYPE html>
<html lang="en">
    <head>
        <script>
        const defaultData = {
            'Bands': [
                { name: 'David Bowie', points: 1, count: 0},
                { name: 'The Church', points: 1, count: 0},
                { name: 'The Cure', points: 1, count: 0},
                { name: 'Depeche Mode', points: 1, count: 0},
                { name: 'Devo', points: 1, count: 0},
                { name: 'Duran Duran', points: 1, count: 0},
                { name: 'Echo and the Bunnymen', points: 1, count: 0},
                { name: 'Information Society', points: 1, count: 0},
                { name: 'INXS', points: 1, count: 0},
                { name: 'New Order/Joy Division', points: 1, count: 0},
                { name: 'OMD', points: 1, count: 0},
                { name: 'Pet Shop Boys', points: 1, count: 0},
                { name: 'The Pixies', points: 1, count: 0},
                { name: 'Prince', points: 1, count: 0},
                { name: 'Psychedelic Furs', points: 1, count: 0},
                { name: 'Replacements', points: 1, count: 0},
                { name: 'Sisters of Mercy', points: 1, count: 0},
                { name: 'Smiths/Morrissey', points: 1, count: 0},
                { name: 'Talking Heads', points: 1, count: 0},
            ],
            'Videos': [
                { name: 'Top of the Pops/Soul Train/etc.', points: 1, count: 0},
                { name: 'Video contains movie footage', points: 1, count: 0},
                { name: 'Band member in stripey shirt', points: 1, count: 0},
                { name: 'Inexplicable prop', points: 1, count: 0},
                { name: 'Saxophone solo', points: 1, count: 0},
                { name: 'Shirtless man', points: 1, count: 0},
                { name: '80s CGI', points: 1, count: 0},
                { name: 'Keytar', points: 1, count: 0}
            ],
            'Events': [
                { name: 'Veto song', points: 10, count: 0},
                { name: 'Dance song', points: 10, count: 0},
                { name: 'DJ Stripey Shirt shirt', points: 10, count: 0},
                { name: 'DJ Wears stripey shirt', points: 10, count: 0}
            ],
            'People': [
                { name: 'Person wearing blinky lights', points: 3, count: 0},
                { name: 'Solo dancer orbiting dance floor', points: 3, count: 0},
                { name: 'Overly elaborately dressed person', points: 3, count: 0},
                { name: 'Person in a costume', points: 3, count: 0},
                { name: 'Line dancing or other choreography', points: 3, count: 0},
                { name: 'REO Speedwagon Bass Player', points: 1, count: 0},
                { name: 'Flandalf', points: 1, count: 0},
                { name: 'DJ Brian Doppelganger', points: 1, count: 0},
                { name: 'The Clapper', points: 1, count: 0},
                { name: 'Not the Fitz Guy', points: 1, count: 0}
            ],
            'DJ Things': [
                { name: 'DJ leaves and doesn’t return in time', points: 100, count: 0},
                { name: 'Extremely bad transition', points: 3, count: 0},
                { name: 'Extremely good transition', points: 3, count: 0},
                { name: 'DJ plays the wrong song', points: 3, count: 0},
                { name: 'Request kills the dance floor', points: 3, count: 0},
                { name: 'Technical issue', points: 3, count: 0},
                { name: 'DJ mentions manatees', points: 1, count: 0},
                { name: 'DJ pitches some other event', points: 1, count: 0},
                { name: 'DJ calls new people “newbies”', points: 1, count: 0}
            ],
            'Songs': [
                { name: 'Artist tribute (e.g., Ozzy)', points: 3, count: 0},
                { name: 'Genre spotlight (e.g., Darkwave)', points: 3, count: 0},
                { name: '0 or 5+ birthday sets', points: 3, count: 0},
                { name: 'Artist’s OTHER band', points: 3, count: 0},
                { name: 'Soundtrack to John Hughes movie', points: 3, count: 0},
                { name: 'Cover song', points: 1, count: 0}
            ],
            'Multipliers': [
                { name: 'ALL OF THE ABOVE (bands)', points: 50, count: 0 },
                { name: 'Band 2+ times', points: 25, count: 0 },
                { name: 'Band 4+ times', points: 50, count: 0 },
            ]
        };
        </script>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Transmission Score Tracker</title>
        <!-- Tailwind CSS via CDN -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Inter Font via Google Fonts CDN -->
        <link rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap">
        <!-- Font Awesome Icons via CDN -->
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* dark gray background */
            color: #e2e8f0; /* light gray text */
        }
        .group-card {
            background-color: #2d3748; /* slightly lighter card background */
        }
        .item-card {
            background-color: #4a5568; /* even lighter background for individual items */
        }
        .button-plus {
            background-color: #48bb78; /* green */
        }
        .button-minus {
            background-color: #f56565; /* red */
        }
        .score-btn {
            width: 5rem; /* 12 */
            height: 5rem; /* 12 */
            font-size: 2rem; /* text-2xl */
        }
    </style>
    </head>
    <body
        class="flex flex-col items-center justify-center min-h-screen p-4 md:p-8">

        <div class="w-full max-w-6xl mx-auto">
            <div class="text-center mb-8">
                <h1
                    class="text-4xl md:text-5xl font-extrabold text-blue-400 mb-2">Transmission
                    Score Tracker</h1>
                <p class="text-lg text-gray-400">Keep track of points for
                    various categories.</p>
            </div>

            <!-- Global Total Score Display and Controls -->
            <div
                class="bg-gray-700 rounded-2xl shadow-lg border border-gray-600 p-6 mb-8 text-center">
                <p class="text-2xl font-semibold text-gray-400 mb-1">Total
                    Score</p>
                <span id="global-total"
                    class="text-6xl font-extrabold text-blue-400">0</span>
                <div
                    class="flex flex-col sm:flex-row items-center justify-center gap-4 mt-6">
                    <button id="export-btn"
                        class="bg-indigo-500 text-white font-bold py-2 px-4 rounded-xl hover:bg-indigo-600 transition duration-300 ease-in-out transform hover:scale-105">
                        <i class="fas fa-clipboard mr-2"></i> Export Scores
                    </button>
                    <button id="reset-btn"
                        class="bg-red-500 text-white font-bold py-2 px-4 rounded-xl hover:bg-red-600 transition duration-300 ease-in-out transform hover:scale-105">
                        <i class="fas fa-undo mr-2"></i> Reset All Scores
                    </button>
                </div>
            </div>

            <!-- Score Groups Container -->
            <div id="score-container" class="space-y-8">
                <!-- Score groups will be dynamically added here by JavaScript -->
            </div>

        </div>

        <!-- Confirmation Modal -->
        <div id="confirmation-modal"
            class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden">
            <div
                class="bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-sm text-center">
                <p class="text-xl font-bold mb-4">Are you sure?</p>
                <p class="mb-6 text-gray-300">This will reset all scores. This
                    cannot be undone.</p>
                <div class="flex justify-center gap-4">
                    <button id="cancel-reset-btn"
                        class="bg-gray-500 text-white font-bold py-2 px-4 rounded-xl hover:bg-gray-600 transition duration-300">Cancel</button>
                    <button id="confirm-reset-btn"
                        class="bg-red-500 text-white font-bold py-2 px-4 rounded-xl hover:bg-red-600 transition duration-300">Reset</button>
                </div>
            </div>
        </div>

        <script>
        let scoreData = JSON.parse(JSON.stringify(defaultData));

        // Cache frequently used DOM elements
        const scoreContainer = document.getElementById('score-container');
        const globalTotalDisplay = document.getElementById('global-total');
        const exportBtn = document.getElementById('export-btn');
        const resetBtn = document.getElementById('reset-btn');
        const confirmationModal = document.getElementById('confirmation-modal');
        const confirmResetBtn = document.getElementById('confirm-reset-btn');
        const cancelResetBtn = document.getElementById('cancel-reset-btn');

        // Function to save data to localStorage
        const saveData = () => {
            localStorage.setItem('transmissionScoreData', JSON.stringify(scoreData));
        };

        // Function to load data from localStorage
        const loadData = () => {
            const storedData = localStorage.getItem('transmissionScoreData');
            if (storedData) {
                scoreData = JSON.parse(storedData);
            }
        };

        // Function to calculate and update global total score, including multiplier logic
        const updateGlobalTotal = () => {
            const bandsItems = scoreData.Bands;
            const multipliersItems = scoreData.Multipliers;
            const allAboveItem = multipliersItems.find(item => item.name === 'ALL OF THE ABOVE (bands)');
            const overTwoItem = multipliersItems.find(item => item.name === 'Band 2+ times');
            const overFourItem = multipliersItems.find(item => item.name === 'Band 4+ times');
            
            // Update Multiplier counts based on Band counts
            if (bandsItems && allAboveItem) {
                const allBandsScored = bandsItems.every(item => item.count > 0);
                allAboveItem.count = allBandsScored ? 1 : 0;
            }
            if (bandsItems && overTwoItem) {
                overTwoItem.count = bandsItems.filter(item => item.count >= 2).length;
            }
            if (bandsItems && overFourItem) {
                overFourItem.count = bandsItems.filter(item => item.count >= 4).length;
            }

            let total = 0;
            for (const groupName in scoreData) {
                scoreData[groupName].forEach(item => {
                    total += item.points * item.count;
                });
            }
            globalTotalDisplay.textContent = total;
            console.log(total);
            saveData();
        };

        // Function to handle score increments and decrements
        const handleScoreUpdate = (groupName, itemIndex, isIncrement) => {
            const item = scoreData[groupName][itemIndex];
            if (isIncrement) {
                item.count++;
            } else if (item.count > 0) {
                item.count--;
            }
            updateGlobalTotal();
            renderScoreGroups();
        };

        // Function to generate the HTML for a single item card
        const createItemCard = (item, groupName, itemIndex) => {
            const itemCard = document.createElement('div');
            itemCard.className = 'item-card p-4 rounded-xl shadow-md border border-gray-700 flex flex-col justify-between';

            let buttonHtml = '';
            // Only add buttons for non-multiplier items
            if (groupName !== 'Multipliers') {
                buttonHtml = `
                    <button class="score-btn score-minus-btn button-minus text-white text-2xl rounded-full flex items-center justify-center hover:bg-red-600 transition duration-200 transform hover:scale-110" data-group="${groupName}" data-index="${itemIndex}">
                        <i class="fas fa-minus"></i>
                    </button>
                    <button class="score-btn score-plus-btn button-plus text-white text-2xl rounded-full flex items-center justify-center hover:bg-green-600 transition duration-200 transform hover:scale-110" data-group="${groupName}" data-index="${itemIndex}">
                        <i class="fas fa-plus"></i>
                    </button>
                `;
            }

            itemCard.innerHTML = `
                <div class="mb-2">
                    <h3 class="text-xl font-semibold text-white leading-tight">${item.name}</h3>
                    <p class="text-sm text-gray-400">Points: <span class="font-bold text-blue-300">${item.points}</span></p>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex flex-col">
                        <span class="text-sm font-medium text-gray-400">Count: 
                        <span class="count-display text-lg font-bold text-white" data-count="${item.count}">${item.count}</span></span>
                    </div>
                    <div class="flex gap-2 button-container">
                        ${buttonHtml}
                    </div>
                </div>
            `;
            return itemCard;
        };

        // Function to render all score groups and items
        const renderScoreGroups = () => {
            scoreContainer.innerHTML = ''; // Clear existing content

            for (const groupName in defaultData) {
                const items = scoreData[groupName];
                
                const groupCard = document.createElement('div');
                groupCard.className = 'group-card p-6 rounded-2xl shadow-lg border border-gray-600';

                const groupTitle = document.createElement('h2');
                groupTitle.className = 'text-3xl font-bold text-blue-400 mb-6';
                groupTitle.textContent = groupName;
                groupCard.appendChild(groupTitle);

                const itemsGrid = document.createElement('div');
                itemsGrid.className = 'grid gap-4 sm:grid-cols-2 lg:grid-cols-3';

                items.forEach((item, itemIndex) => {
                    const itemCard = createItemCard(item, groupName, itemIndex);
                    itemsGrid.appendChild(itemCard);
                });

                groupCard.appendChild(itemsGrid);
                scoreContainer.appendChild(groupCard);
            }
            // Attach event listeners after all elements are in the DOM
            attachEventListeners();
        };
        
        // Function to attach all event listeners
        const attachEventListeners = () => {
            const plusButtons = document.querySelectorAll('.score-plus-btn');
            const minusButtons = document.querySelectorAll('.score-minus-btn');

            plusButtons.forEach(button => {
                const groupName = button.dataset.group;
                const itemIndex = parseInt(button.dataset.index, 10);
                button.addEventListener('click', () => handleScoreUpdate(groupName, itemIndex, true));
            });

            minusButtons.forEach(button => {
                const groupName = button.dataset.group;
                const itemIndex = parseInt(button.dataset.index, 10);
                button.addEventListener('click', () => handleScoreUpdate(groupName, itemIndex, false));
            });
        };

        // Export scores to clipboard in TSV
        exportBtn.addEventListener('click', () => {
            // Get the current date and format it as YYYY-MM-DD
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are zero-based
            const day = String(today.getDate()).padStart(2, '0');
            const formattedDate = `${year}-${month}-${day}`;

            // Start the export string with the date and total score at the top
            let exportString = `Date:\t${formattedDate}\n`;
            exportString += `Total Score:\t${globalTotalDisplay.textContent}\n\n`; // Two newlines for a blank row

            // Add the TSV headers
            exportString += "Category\tItem\tCount\tPoints per Item\tSubtotal\n";
            
            // Loop through each group and item to build the data rows
            for (const groupName in scoreData) {
                const items = scoreData[groupName];
                items.forEach(item => {
                    // Only include items that have a count greater than 0
                    if (item.count > 0) {
                        const subtotal = item.count * item.points;
                        // Append a new row with values separated by tabs
                        exportString += `${groupName}\t${item.name}\t${item.count}\t${item.points}\t${subtotal}\n`;
                    }
                });
            }

            // Use the modern Clipboard API to copy the text
            navigator.clipboard.writeText(exportString).then(() => {
                alert("Scores copied to clipboard!");
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                alert("Could not copy scores to clipboard.");
            });
        });

        // Show confirmation modal for reset button
        resetBtn.addEventListener('click', () => {
            confirmationModal.classList.remove('hidden');
        });

        // Handle reset confirmation
        confirmResetBtn.addEventListener('click', () => {
            localStorage.removeItem('transmissionScoreData');
            scoreData = JSON.parse(JSON.stringify(defaultData));
            confirmationModal.classList.add('hidden');
            updateGlobalTotal();
            renderScoreGroups();
        });

        // Handle reset cancellation
        cancelResetBtn.addEventListener('click', () => {
            confirmationModal.classList.add('hidden');
        });
        
        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            updateGlobalTotal();
            renderScoreGroups();
        });

    </script>

    </body>
</html>
